#!/bin/zsh -e
# Copyright Epic Games, Inc. All Rights Reserved.

OPENSSL_VERSION=1.1.1t
ZLIB_VERSION=1.3
NGHTTP2_VERSION=1.64.0

LIB_ROOT=${0:a:h:h:h}
THIRDPARTY_ROOT=${LIB_ROOT:h:h}
ENGINE_ROOT=${THIRDPARTY_ROOT:h:h}
CMAKE_ADDITIONAL_ARGUMENTS="-DENABLE_LIB_ONLY=ON -DBUILD_SHARED_LIBS=OFF -DBUILD_STATIC_LIBS=ON -DENABLE_DOC=OFF -DCMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH=OFF"
CMAKE_OPENSSL_ARGUMENTS="-DOPENSSL_CRYPTO_LIBRARY=${THIRDPARTY_ROOT}/OpenSSL/${OPENSSL_VERSION}/lib/Mac/libcrypto.a -DOPENSSL_SSL_LIBRARY=${THIRDPARTY_ROOT}/OpenSSL/${OPENSSL_VERSION}/lib/Mac/libssl.a -DOPENSSL_INCLUDE_DIR=${THIRDPARTY_ROOT}/OpenSSL/${OPENSSL_VERSION}/include/Mac -DOPENSSL_USE_STATIC_LIBS=ON"
CMAKE_ZLIB_ARGUMENTS="-DZLIB_LIBRARY=${THIRDPARTY_ROOT}/zlib/${ZLIB_VERSION}/lib/Mac/Release/libz.a -DZLIB_INCLUDE_DIR=%THIRDPARTY_ROOT%/zlib/${ZLIB_VERSION}/include"
${THIRDPARTY_ROOT}/CMake/PlatformScripts/Mac/BuildLibForMac.command ${LIB_ROOT:h:t} ${LIB_ROOT:t} --config=Release --cmake-args="${CMAKE_ADDITIONAL_ARGUMENTS} ${CMAKE_OPENSSL_ARGUMENTS} ${CMAKE_ZLIB_ARGUMENTS}"
